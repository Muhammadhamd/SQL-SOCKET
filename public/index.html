<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<style>
    .main{
        display: flex;
    }
    .main div {
        border: 2px solid black;
        width: 200px;
        height: 300px;
        margin: 0px 10px;
    }
</style>
    <div class="main">
        <div >
            <button id="first">vote</button>
            <h1 id="first-per"></h1>
        </div>
        <div >
            <button id="second">vote</button>
            <h1 id="second-per"></h1>

        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        let votesArray = {}
        const socket = io("/notify")

        socket.on("connect",(scoket)=>{
            console.log(socket.id)
        })
        let firstPoll = document.getElementById("first")
        let secondPoll = document.getElementById("second")

        function Calculate(first ,second){
            let total = (first || 0) + (second || 0);
            document.getElementById("first-per").innerHTML = ((first / total) * 100 ) 
             document.getElementById("second-per").innerHTML =( (second / total) * 100) 
           
        }

        document.addEventListener("DOMContentLoaded",(e)=>{
                      console.log("af")
            axios.get("/votes")
            .then((res)=>{console.log(res)
              votesArray =  res.data
                Calculate(res.data?.first?.length , res.data?.second?.length)

               
            })
            .catch((err)=>console.log(err))
        })

        firstPoll.addEventListener("click",(e)=>{
     console.log("click")
            axios.post("/add-vote",{voteTo:"first"})
            .then((res)=>{console.log(res)
            
               
            })
            .catch((e)=>{console.log(e)})
            socket.on("new-vote",(data)=>{
                console.log(data.votes)
                Calculate(votes.first , votes.second)
            })
        })
        secondPoll.addEventListener("click",(e)=>{
            console.log("click")

axios.post("/add-vote",{voteTo:"second"})
.thne((res)=>{console.log(res)
    socket.on("new-vote",(data)=>{
        Calculate(votes.first , votes.second)

            })
})
.catch((e)=>{console.log(e)})
})
    </script>
</body>
</html>